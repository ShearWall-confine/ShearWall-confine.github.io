<!DOCTYPE html>
<!-- 
    课题进度管理系统
    版本: 1.0.0
    作者: [作者名]
    最后更新: 2025-01-18
    功能: 项目进度管理、任务跟踪、时间线管理、文件管理
-->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <title>课题进度管理系统</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" as="script">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <main class="container" role="main">
        <!-- 头部导航 -->
        <header class="header" role="banner">
            <h1><i class="fas fa-project-diagram"></i> 课题进度管理系统</h1>
            <div class="header-actions">
                <button class="btn btn-theme" onclick="toggleThemeSelector()" title="切换主题">
                    <i class="fas fa-palette"></i> 主题
                </button>
                <button class="btn btn-primary" onclick="exportData()">
                    <i class="fas fa-download"></i> 导出数据
                </button>
                <button class="btn btn-secondary" onclick="importData()">
                    <i class="fas fa-upload"></i> 导入数据
                </button>
                <button class="btn btn-info" onclick="compareData()">
                    <i class="fas fa-chart-line"></i> 对比数据
                </button>
                <button class="btn btn-success" onclick="setupGitHubSync()">
                    <i class="fab fa-github"></i> GitHub同步
                </button>
                <button class="btn btn-warning" onclick="syncFromGitHub()">
                    <i class="fas fa-sync"></i> 从云端同步
                </button>
                <button class="btn btn-info" onclick="goToHomePage()">
                    <i class="fas fa-home"></i> 返回课题组
                </button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
                <input type="file" id="compareFile" accept=".json" style="display: none;" onchange="handleCompare(event)">
            </div>
        </header>

        <!-- 主题选择器 -->
        <div id="theme-selector" class="theme-selector" style="display: none;">
            <div class="theme-selector-header">
                <h3><i class="fas fa-palette"></i> 选择主题配色</h3>
                <span class="close" onclick="toggleThemeSelector()">&times;</span>
            </div>
            <div class="theme-options">
                <!-- 经典主题分类 -->
                <div class="theme-category">
                    <h4><i class="fas fa-star"></i> 经典主题</h4>
                    <div class="theme-option" data-theme="default" 
                         data-colors='["#667eea", "#764ba2", "#4CAF50", "#ffc107"]'
                         role="button" tabindex="0" 
                         aria-label="选择默认主题"
                         onclick="changeTheme('default')">
                        <div class="theme-preview">
                            <div class="theme-color theme-color-1"></div>
                            <div class="theme-color theme-color-2"></div>
                            <div class="theme-color theme-color-3"></div>
                            <div class="theme-color theme-color-4"></div>
                        </div>
                        <span class="theme-name">默认主题</span>
                        <i class="fas fa-check theme-check" aria-hidden="true"></i>
                    </div>
                    <div class="theme-option" data-theme="dark" onclick="changeTheme('dark')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #1f2937;"></div>
                            <div class="theme-color" style="background: #374151;"></div>
                            <div class="theme-color" style="background: #4b5563;"></div>
                            <div class="theme-color" style="background: #6b7280;"></div>
                        </div>
                        <span class="theme-name">暗夜模式</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                </div>

                <!-- 自然主题分类 -->
                <div class="theme-category">
                    <h4><i class="fas fa-leaf"></i> 自然主题</h4>
                    <div class="theme-option" data-theme="forest" onclick="changeTheme('forest')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #064e3b;"></div>
                            <div class="theme-color" style="background: #059669;"></div>
                            <div class="theme-color" style="background: #10b981;"></div>
                            <div class="theme-color" style="background: #34d399;"></div>
                        </div>
                        <span class="theme-name">森林绿</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="ocean" onclick="changeTheme('ocean')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #1e3a8a;"></div>
                            <div class="theme-color" style="background: #3b82f6;"></div>
                            <div class="theme-color" style="background: #06b6d4;"></div>
                            <div class="theme-color" style="background: #10b981;"></div>
                        </div>
                        <span class="theme-name">深海蓝</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="sky" onclick="changeTheme('sky')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #0ea5e9;"></div>
                            <div class="theme-color" style="background: #38bdf8;"></div>
                            <div class="theme-color" style="background: #7dd3fc;"></div>
                            <div class="theme-color" style="background: #bae6fd;"></div>
                        </div>
                        <span class="theme-name">天空蓝</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="earth" onclick="changeTheme('earth')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #92400e;"></div>
                            <div class="theme-color" style="background: #d97706;"></div>
                            <div class="theme-color" style="background: #f59e0b;"></div>
                            <div class="theme-color" style="background: #fbbf24;"></div>
                        </div>
                        <span class="theme-name">大地黄</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                </div>

                <!-- 色彩主题分类 -->
                <div class="theme-category">
                    <h4><i class="fas fa-palette"></i> 色彩主题</h4>
                    <div class="theme-option" data-theme="sunset" 
                         data-colors='["#2d4059", "#ea5455", "#f07b3f", "#ffd460"]'
                         role="button" tabindex="0" 
                         aria-label="选择日落橙主题"
                         onclick="changeTheme('sunset')">
                        <div class="theme-preview">
                            <div class="theme-color theme-color-1"></div>
                            <div class="theme-color theme-color-2"></div>
                            <div class="theme-color theme-color-3"></div>
                            <div class="theme-color theme-color-4"></div>
                        </div>
                        <span class="theme-name">日落橙</span>
                        <i class="fas fa-check theme-check" aria-hidden="true"></i>
                    </div>
                    <div class="theme-option" data-theme="sakura" onclick="changeTheme('sakura')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #ffc7c7;"></div>
                            <div class="theme-color" style="background: #ffe2e2;"></div>
                            <div class="theme-color" style="background: #f6f6f6;"></div>
                            <div class="theme-color" style="background: #8785a2;"></div>
                        </div>
                        <span class="theme-name">樱花粉</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="purple" onclick="changeTheme('purple')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #581c87;"></div>
                            <div class="theme-color" style="background: #9333ea;"></div>
                            <div class="theme-color" style="background: #a855f7;"></div>
                            <div class="theme-color" style="background: #c084fc;"></div>
                        </div>
                        <span class="theme-name">神秘紫</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="rose" onclick="changeTheme('rose')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #be185d;"></div>
                            <div class="theme-color" style="background: #ec4899;"></div>
                            <div class="theme-color" style="background: #f472b6;"></div>
                            <div class="theme-color" style="background: #fbb6ce;"></div>
                        </div>
                        <span class="theme-name">玫瑰红</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                </div>

                <!-- 季节主题分类 -->
                <div class="theme-category">
                    <h4><i class="fas fa-calendar-alt"></i> 季节主题</h4>
                    <div class="theme-option" data-theme="spring" onclick="changeTheme('spring')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #16a34a;"></div>
                            <div class="theme-color" style="background: #22c55e;"></div>
                            <div class="theme-color" style="background: #4ade80;"></div>
                            <div class="theme-color" style="background: #86efac;"></div>
                        </div>
                        <span class="theme-name">春日绿</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="summer" onclick="changeTheme('summer')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #dc2626;"></div>
                            <div class="theme-color" style="background: #f97316;"></div>
                            <div class="theme-color" style="background: #fbbf24;"></div>
                            <div class="theme-color" style="background: #fde047;"></div>
                        </div>
                        <span class="theme-name">夏日橙</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="autumn" onclick="changeTheme('autumn')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #92400e;"></div>
                            <div class="theme-color" style="background: #d97706;"></div>
                            <div class="theme-color" style="background: #f59e0b;"></div>
                            <div class="theme-color" style="background: #fbbf24;"></div>
                        </div>
                        <span class="theme-name">秋日黄</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="winter" onclick="changeTheme('winter')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #1e40af;"></div>
                            <div class="theme-color" style="background: #3b82f6;"></div>
                            <div class="theme-color" style="background: #60a5fa;"></div>
                            <div class="theme-color" style="background: #93c5fd;"></div>
                        </div>
                        <span class="theme-name">冬日蓝</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                </div>

                <!-- 专业主题分类 -->
                <div class="theme-category">
                    <h4><i class="fas fa-briefcase"></i> 专业主题</h4>
                    <div class="theme-option" data-theme="business" onclick="changeTheme('business')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #1f2937;"></div>
                            <div class="theme-color" style="background: #374151;"></div>
                            <div class="theme-color" style="background: #4b5563;"></div>
                            <div class="theme-color" style="background: #6b7280;"></div>
                        </div>
                        <span class="theme-name">商务灰</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="tech" onclick="changeTheme('tech')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #0f172a;"></div>
                            <div class="theme-color" style="background: #1e293b;"></div>
                            <div class="theme-color" style="background: #0ea5e9;"></div>
                            <div class="theme-color" style="background: #38bdf8;"></div>
                        </div>
                        <span class="theme-name">科技蓝</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="creative" onclick="changeTheme('creative')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #7c3aed;"></div>
                            <div class="theme-color" style="background: #a855f7;"></div>
                            <div class="theme-color" style="background: #ec4899;"></div>
                            <div class="theme-color" style="background: #f472b6;"></div>
                        </div>
                        <span class="theme-name">创意紫</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                    <div class="theme-option" data-theme="minimal" onclick="changeTheme('minimal')">
                        <div class="theme-preview">
                            <div class="theme-color" style="background: #f8fafc;"></div>
                            <div class="theme-color" style="background: #e2e8f0;"></div>
                            <div class="theme-color" style="background: #cbd5e1;"></div>
                            <div class="theme-color" style="background: #94a3b8;"></div>
                        </div>
                        <span class="theme-name">极简白</span>
                        <i class="fas fa-check theme-check"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="main-content" role="main">
            <!-- 左侧列 - 时间线 -->
            <div class="content-left-sidebar">
                <!-- 时间线 -->
                <section class="section section-sidebar" id="timeline-sidebar">
                    <div class="section-header">
                        <h2><i class="fas fa-calendar-alt"></i> 时间线</h2>
                        <button class="btn btn-primary" onclick="addTimelineItem()">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="section-content">
                        <!-- 视图切换 -->
                        <div class="timeline-view-toggle">
                            <button class="btn active" onclick="switchTimelineView('list')" id="timeline-list-btn">
                                <i class="fas fa-list"></i> 列表
                            </button>
                            <button class="btn" onclick="switchTimelineView('calendar')" id="timeline-calendar-btn">
                                <i class="fas fa-calendar"></i> 日历
                            </button>
                        </div>
                        
                        <!-- 时间线过滤控件 -->
                        <div class="timeline-filters">
                            <div class="timeline-filter-group">
                                <label>时间范围：</label>
                                <select id="timeline-date-range" onchange="filterTimelineByDateRange()">
                                    <option value="all">全部时间</option>
                                    <option value="today">今天</option>
                                    <option value="week">本周</option>
                                    <option value="month">本月</option>
                                    <option value="quarter">本季度</option>
                                    <option value="year">本年</option>
                                    <option value="future">未来</option>
                                    <option value="past">历史</option>
                                    <option value="custom">自定义</option>
                                </select>
                            </div>
                            <div class="timeline-filter-group" id="custom-date-range" style="display: none;">
                                <label>开始日期：</label>
                                <input type="date" id="timeline-start-date" onchange="filterTimelineByCustomDate()">
                                <label>结束日期：</label>
                                <input type="date" id="timeline-end-date" onchange="filterTimelineByCustomDate()">
                            </div>
                            <div class="timeline-filter-group">
                                <label>显示模式：</label>
                                <select id="timeline-display-mode" onchange="changeTimelineDisplayMode()">
                                    <option value="all">显示全部</option>
                                    <option value="compact">紧凑模式</option>
                                    <option value="grouped">分组显示</option>
                                </select>
                            </div>
                            <div class="timeline-filter-group">
                                <button class="btn btn-secondary btn-sm" onclick="toggleTimelineCollapse()" id="timeline-collapse-btn">
                                    <i class="fas fa-chevron-up"></i> 折叠历史
                                </button>
                            </div>
                        </div>
                        
                        <!-- 列表视图 -->
                        <div class="timeline-vertical" id="timeline-vertical-container">
                            <!-- 时间线项目将在这里动态生成 -->
                        </div>
                        
                        <!-- 日历视图 -->
                        <div class="timeline-calendar" id="timeline-calendar-container">
                            <div class="calendar-header">
                                <div class="calendar-nav">
                                    <button class="btn btn-secondary" onclick="changeCalendarMonth(-1)">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <span class="calendar-month" id="calendar-month-display">2024年1月</span>
                                    <button class="btn btn-secondary" onclick="changeCalendarMonth(1)">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                <button class="btn btn-primary" onclick="goToToday()">
                                    <i class="fas fa-home"></i> 今天
                                </button>
                            </div>
                            <div class="calendar-grid" id="calendar-grid">
                                <!-- 日历网格将在这里动态生成 -->
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- 中间列 -->
            <div class="content-center">
                <!-- 项目概览 -->
                <section class="section" id="overview">
                    <div class="section-header">
                        <h2><i class="fas fa-eye"></i> 项目概览</h2>
                        <button class="btn btn-edit" onclick="editSection('overview')">
                            <i class="fas fa-edit"></i> 编辑
                        </button>
                    </div>
                    <div class="section-content" id="overview-content">
                        <div class="overview-grid">
                            <div class="overview-card">
                                <h3>项目名称</h3>
                                <p id="project-name">我的研究课题</p>
                            </div>
                            <div class="overview-card">
                                <h3>开始时间</h3>
                                <p id="start-date">2024-01-01</p>
                            </div>
                            <div class="overview-card">
                                <h3>预计完成</h3>
                                <p id="end-date">2024-12-31</p>
                            </div>
                            <div class="overview-card">
                                <h3>整体进度</h3>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="overall-progress" style="width: 25%"></div>
                                </div>
                                <span id="progress-text">25%</span>
                            </div>
                        </div>
                        <div class="overview-description">
                            <h3>项目整体思路</h3>
                            <div id="project-description" class="editable-content">
                                在这里描述您的课题整体思路和研究目标...
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 工作清单 -->
                <section class="section" id="tasks">
                    <div class="section-header">
                        <h2><i class="fas fa-tasks"></i> 工作清单</h2>
                <button class="btn btn-primary" onclick="addTask()" 
                        aria-label="添加新任务" role="button">
                    <i class="fas fa-plus" aria-hidden="true"></i> 添加任务
                </button>
                    </div>
                    <div class="section-content">
                        <div class="task-filters">
                            <button class="filter-btn active" data-status="all">全部</button>
                            <button class="filter-btn" data-status="pending">待开始</button>
                            <button class="filter-btn" data-status="in-progress">进行中</button>
                            <button class="filter-btn" data-status="completed">已完成</button>
                        </div>
                        <div class="tasks-container" id="tasks-container">
                            <!-- 任务列表将在这里动态生成 -->
                        </div>
                    </div>
                </section>


                <!-- 文件管理 -->
                <section class="section" id="files">
                    <div class="section-header">
                        <h2><i class="fas fa-folder"></i> 文件管理</h2>
                        <div class="file-header-actions">
                            <button class="btn btn-theme" onclick="selectLocalDirectory()" title="选择本地files目录">
                                <i class="fas fa-folder-open"></i> <span id="fs-access-text">选择目录</span>
                            </button>
                            <button class="btn btn-secondary" id="quick-reconnect-btn" onclick="quickReconnectDirectory()" title="快速重连到记忆的目录" style="display: none;">
                                <i class="fas fa-redo"></i> 快速重连
                            </button>
                            <button class="btn btn-secondary" onclick="manualSyncFiles()" title="手动同步文件">
                                <i class="fas fa-sync"></i> 同步
                            </button>
                            <button class="btn btn-secondary" onclick="showSyncStatus()" title="查看同步状态">
                                <i class="fas fa-info-circle"></i> 状态
                            </button>
                            <button class="btn btn-secondary" onclick="repairFileSync()" title="修复同步问题">
                                <i class="fas fa-wrench"></i> 修复
                            </button>
                            <button class="btn btn-edit" onclick="addFolder()">
                                <i class="fas fa-folder-plus"></i> 新建文件夹
                            </button>
                            <button class="btn btn-primary" onclick="uploadFile()">
                                <i class="fas fa-upload"></i> 上传文件
                            </button>
                        </div>
                    </div>
                    <div id="directory-display" class="directory-display" style="display: none;">
                        <div class="directory-info">
                            <i class="fas fa-folder-open"></i>
                            <span id="directory-path">当前目录路径将在这里显示</span>
                        </div>
                        <button class="btn btn-copy" onclick="copyDirectoryPath()" title="复制目录路径">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <input type="file" id="fileInput" multiple style="display: none;" onchange="handleFileUpload(event)">
                    <div class="section-content">
                        <!-- 树形视图 -->
                        <div id="files-tree-view" class="files-view-container" style="display: block;">
                            <div class="file-tree-toolbar">
                                <div class="breadcrumb" id="file-breadcrumb">
                                    <span class="breadcrumb-item active" onclick="navigateToFolder(null)">
                                        <i class="fas fa-home"></i> 根目录
                                    </span>
                                </div>
                                <div class="file-search">
                                    <input type="text" placeholder="搜索文件..." id="file-search-input" onkeyup="searchFiles(this.value)">
                                    <i class="fas fa-search"></i>
                                </div>
                            </div>
                            <div class="file-tree" id="file-tree">
                                <!-- 文件树形结构将在这里动态生成 -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 成果展示 -->
                <section class="section" id="results">
                    <div class="section-header">
                        <h2><i class="fas fa-trophy"></i> 成果展示</h2>
                        <button class="btn btn-primary" onclick="addResult()">
                            <i class="fas fa-plus"></i> 添加成果
                        </button>
                    </div>
                    <div class="section-content">
                        <div class="results-container" id="results-container">
                            <!-- 成果列表将在这里动态生成 -->
                        </div>
                    </div>
                </section>
            </div>

            <!-- 右侧列 - 技术路线图 -->
            <div class="content-right">
                <section class="section" id="tech-roadmap">
                    <div class="section-header">
                        <h2><i class="fas fa-route"></i> 技术路线图</h2>
                        <div class="roadmap-actions">
                            <button class="btn btn-edit" onclick="editRoadmap()">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="btn btn-primary" onclick="addRoadmapNode()">
                                <i class="fas fa-plus"></i> 添加节点
                            </button>
                            <button class="btn btn-secondary" onclick="switchRoadmapView('list')" id="roadmap-list-btn">
                                <i class="fas fa-list"></i> 列表
                            </button>
                            <button class="btn btn-secondary" onclick="switchRoadmapView('mindmap')" id="roadmap-mindmap-btn">
                                <i class="fas fa-project-diagram"></i> 思维导图
                            </button>
                        </div>
                    </div>
                    <div class="section-content">
                        <!-- 列表视图 -->
                        <div class="roadmap-list" id="roadmap-list-container">
                            <div class="roadmap-container" id="roadmap-container">
                                <!-- 技术路线图节点将在这里动态生成 -->
                            </div>
                        </div>
                        
                        <!-- 思维导图视图 -->
                        <div class="roadmap-mindmap" id="roadmap-mindmap-container">
                            <div class="mindmap-import">
                                <h4><i class="fas fa-file-import"></i> 导入文件生成思维导图</h4>
                                <div class="mindmap-import-options">
                                    <button class="btn btn-primary" onclick="selectMarkdownFile()">
                                        <i class="fas fa-file-upload"></i> 选择Markdown文件
                                    </button>
                                    <button class="btn btn-primary" onclick="selectExcelFile()">
                                        <i class="fas fa-file-excel"></i> 选择Excel文件
                                    </button>
                                    <span class="import-divider">或</span>
                                    <button class="btn btn-secondary" onclick="toggleTextInput()">
                                        <i class="fas fa-keyboard"></i> 手动输入
                                    </button>
                                </div>
                                <div id="mindmap-text-input" class="mindmap-text-input" style="display: none;">
                                    <textarea id="mindmap-md-input" placeholder="请输入 Markdown 格式的文本，例如：

# 项目技术路线

## 第一阶段：需求分析
- 用户需求调研
- 功能需求分析
- 技术需求评估

## 第二阶段：系统设计
- 架构设计
- 数据库设计
- 接口设计

## 第三阶段：开发实现
- 前端开发
- 后端开发
- 测试验证"></textarea>
                                </div>
                                <div class="mindmap-import-actions">
                                    <button class="btn btn-primary" onclick="generateMindmapFromMD()">
                                        <i class="fas fa-magic"></i> 生成思维导图
                                    </button>
                                    <button class="btn btn-secondary" onclick="clearMindmap()">
                                        <i class="fas fa-trash"></i> 清空
                                    </button>
                                    <button class="btn btn-info" onclick="openMindmapViewer()" id="view-mindmap-btn" style="display: none;">
                                        <i class="fas fa-external-link-alt"></i> 全屏查看
                                    </button>
                                    <button class="btn btn-secondary" onclick="toggleMindmapHistory()">
                                        <i class="fas fa-history"></i> 历史记录
                                    </button>
                                    <button class="btn btn-secondary" onclick="testMarkdownParsing()" title="测试Markdown解析">
                                        <i class="fas fa-bug"></i> 测试解析
                                    </button>
                                </div>
                                
                                <!-- 思维导图历史记录 -->
                                <div id="mindmap-history" class="mindmap-history" style="display: none;">
                                    <h5><i class="fas fa-history"></i> 思维导图历史记录</h5>
                                    <div id="mindmap-history-list" class="mindmap-history-list">
                                        <!-- 历史记录将在这里动态生成 -->
                                    </div>
                                </div>
                                <input type="file" id="markdown-file-input" accept=".md,.txt" style="display: none;" onchange="handleMarkdownFileUpload(event)">
                                <input type="file" id="excel-file-input" accept=".xlsx,.xls" style="display: none;" onchange="handleExcelFileUpload(event)">
                            </div>
                            <div class="mindmap-container" id="mindmap-container">
                                <!-- 思维导图将在这里动态生成 -->
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- 加载状态指示 -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;" role="status" aria-live="polite">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin" aria-hidden="true"></i>
            <span>加载中...</span>
        </div>
    </div>

    <!-- 错误提示区域 -->
    <div id="error-container" class="error-container" role="alert" aria-live="polite" style="display: none;">
        <!-- 错误消息将在这里显示 -->
    </div>

    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">编辑</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- 模态框内容将在这里动态生成 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                <button class="btn btn-primary" onclick="saveModal()">保存</button>
            </div>
        </div>
    </div>

    <!-- 任务详情模态框 -->
    <div id="taskModal" class="modal" role="dialog" 
         aria-labelledby="taskModal-title" 
         aria-modal="true" 
         aria-hidden="true">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="taskModal-title">任务详情</h3>
                <button class="close" onclick="closeTaskModal()" 
                        aria-label="关闭对话框">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="taskModal-body">
                <!-- 任务详情内容将在这里动态生成 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTaskModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 技术路线图节点编辑模态框 -->
    <div id="roadmapModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="roadmapModal-title">编辑技术路线节点</h3>
                <span class="close" onclick="closeRoadmapModal()">&times;</span>
            </div>
            <div class="modal-body" id="roadmapModal-body">
                <!-- 技术路线图节点编辑内容将在这里动态生成 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRoadmapModal()">取消</button>
                <button class="btn btn-primary" onclick="saveRoadmapNode()">保存</button>
            </div>
        </div>
    </div>

        <!-- 时间线编辑模态框 -->
        <div id="timelineModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="timelineModalTitle">添加时间线项目</h3>
                    <span class="close" onclick="closeTimelineModal()">&times;</span>
                </div>
                <form class="modal-body" id="timeline-form" novalidate>
                    <div class="form-group">
                        <label for="timelineDate">日期 <span class="required">*</span></label>
                        <input type="date" id="timelineDate" name="date" class="form-control" required 
                               aria-describedby="date-help">
                        <div id="date-help" class="form-help">请选择日期</div>
                    </div>
                    <div class="form-group">
                        <label for="timelineTitle">标题 <span class="required">*</span></label>
                        <input type="text" id="timelineTitle" name="title" class="form-control" 
                               placeholder="例如：项目启动" required 
                               pattern=".{3,50}" 
                               title="标题长度应在3-50个字符之间"
                               aria-describedby="title-help">
                        <div id="title-help" class="form-help">标题长度应在3-50个字符之间</div>
                    </div>
                    <div class="form-group">
                        <label for="timelineDescription">描述</label>
                        <textarea id="timelineDescription" name="description" class="form-control" rows="3" 
                                  placeholder="简要描述这个时间点的内容" 
                                  aria-describedby="description-help"></textarea>
                        <div id="description-help" class="form-help">可选：添加详细描述</div>
                    </div>
                    <div class="form-group">
                        <label for="timelineStatus">状态 <span class="required">*</span></label>
                        <select id="timelineStatus" name="status" class="form-control" required 
                                aria-describedby="status-help">
                            <option value="pending">待完成</option>
                            <option value="in-progress">进行中</option>
                            <option value="completed">已完成</option>
                        </select>
                        <div id="status-help" class="form-help">选择任务状态</div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeTimelineModal()">取消</button>
                        <button class="btn btn-primary" onclick="saveTimelineItem()">保存</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 文件夹编辑模态框 -->
        <div id="folderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="folderModal-title">新建文件夹</h3>
                <span class="close" onclick="closeFolderModal()">&times;</span>
            </div>
            <div class="modal-body" id="folderModal-body">
                <!-- 文件夹编辑内容将在这里动态生成 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeFolderModal()">取消</button>
                <button class="btn btn-primary" onclick="saveFolder()">保存</button>
            </div>
        </div>
    </div>

    <!-- SheetJS for Excel file reading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script src="auth.js"></script>
    <script src="github-sync.js" defer></script>
    <script src="script.js" defer></script>
    
    <!-- 认证检查和基础错误处理 -->
    <script>
        // 防重复加载保护
        if (window.pageLoaded) {
            console.log('页面已加载，防止重复加载');
        } else {
            window.pageLoaded = true;
        }
        
        // 立即执行认证检查
        document.addEventListener('DOMContentLoaded', function() {
            console.log('开始认证检查...');
            
            // 等待auth.js加载完成
            const checkAuth = () => {
                if (typeof checkAuthentication === 'function') {
                    console.log('执行认证检查');
                    checkAuthentication();
                } else {
                    console.log('auth.js未加载，1秒后重试...');
                    setTimeout(checkAuth, 1000);
                }
            };
            
            // 立即检查一次，如果失败则延迟重试
            if (typeof checkAuthentication === 'function') {
                checkAuthentication();
            } else {
                setTimeout(checkAuth, 100);
            }
        });
        
        // 基础功能备用
        if (typeof window.goToHomePage === 'undefined') {
            window.goToHomePage = function() {
                if (confirm('确定要返回课题组首页吗？')) {
                    window.location.href = 'index.html';
                }
            };
        }
    </script>
</body>
</html>
